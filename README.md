# CnToCs - 中文转C#编译器

这是一个将中文编程语言转换为C#代码的编译器项目。该项目采用经典的编译器架构，支持全中文编程语法，不依赖任何容器运行，直接输出C#代码。
## 开发声明 ##
本项目由暮雨+Kilo Code辅助开发完成。ai提供：创作思路以及代码检查修复。详细说明：AI使用声明.md
## 项目特点

- 🀄 **全中文命名**：所有的类、方法、变量和文件都使用中文命名
- 📝 **详细注释**：每个类和方法都有详细的中文注释
- 🚀 **直接输出**：不依赖任何容器，直接生成C#代码文件
- 🏗️ **模块化设计**：采用经典的编译器架构（词法分析、语法分析、代码生成）
- 🔄 **一键编译**：提供批处理脚本，支持批量编译多个.My文件
- 📖 **语法规则**：详细的My语言语法说明，参见 [My语法规则.md](My语法规则.md)
- 🎯 **测试**：展示了项目运行方式

## 项目结构

```
CnToCs/
├── CnToCs.csproj           # 项目配置文件
├── 程序入口.cs              # 主程序入口
├── 一键编译.bat            # 批量编译脚本
├── AI使用声明.md           # AI辅助开发声明
├── README.md              # 项目说明文档
├── 抽象语法树/
│   └── 抽象语法树.cs       # AST节点定义
├── 词法分析器/
│   └── 词法分析器.cs       # 词法分析器
├── 语法分析器/
│   └── 语法分析器.cs       # 语法分析器
├── Cs代码生成器/
│   └── Cs代码生成器.cs     # C#代码生成器
├── 测试文件/
│   └── 产品管理.My         # 完整功能测试文件
└── 输出文件/              # 生成的C#文件目录
```

## 支持的语法

### 基本类型
- `字符串` → `string`
- `整数` → `int`
- `小数` → `double`
- `布尔值` → `bool`
- `对象` → `object`
- `无返回值` → `void`

### 访问修饰符
- `公开` → `public`
- `私有` → `private`
- `保护` → `protected`
- `只读` → `readonly`
- `静态` → `static`

### 特殊标记
- `可为空` → `?` (可空类型)
- `引用` → `ref` (引用参数)

### 方法定义
- `方法` → 普通方法
- `虚方法` → `virtual` 方法
- `重写方法` → `override` 方法
- `抽象方法` → `abstract` 方法

### 定义结构

#### 接口定义
```中文
接口 I产品 {
    公开 产品ID: 整数;
    公开 产品名称: 字符串;
    公开 产品价格: 小数;
    公开 是否可用: 布尔值;
    
    抽象方法 获取详细信息: 字符串;
    虚方法 计算折扣: 小数(折扣率: 小数);
    方法 更新价格: 无返回值(新价格: 小数);
}
```

#### 类定义
```中文
类 基础产品 继承 I产品 {
    公开 产品ID: 整数;
    公开 产品名称: 字符串;
    公开 产品价格: 小数;
    公开 是否可用: 布尔值;
    只读 创建时间: 字符串;
    静态 产品总数: 整数;
    
    构造函数(id: 整数, 名称: 字符串, 价格: 小数) {
        产品ID = id;
        产品名称 = 名称;
        产品价格 = 价格;
        是否可用 = true;
        创建时间 = "2023-01-01";
        产品总数++;
    }
    
    方法 获取详细信息: 字符串 {
        返回 "产品ID: " + 产品ID + ", 名称: " + 产品名称 + ", 价格: " + 产品价格;
    }
    
    重写方法 计算折扣: 小数(折扣率: 小数) {
        返回 产品价格 * 折扣率;
    }
    
    方法 更新价格: 无返回值(新价格: 小数) {
        产品价格 = 新价格;
    }
}
```

## 使用方法

### 方式一：使用一键编译脚本（推荐）

```bash
# Windows环境下双击运行或在命令行执行
一键编译.bat
```

该脚本会：
1. 自动编译项目
2. 遍历以下目录中的所有`.My`文件：
   - `测试文件/`
   - `../input/`
   - 当前目录
3. 将编译结果输出到`输出文件/`目录
4. 显示编译统计信息

### 方式二：手动编译

```bash
# 编译项目
dotnet build

# 编译单个文件
dotnet run <输入文件路径> [输出文件路径]

# 示例
dotnet run 测试文件/产品管理.My 输出文件/产品管理.cs

# 如果不指定输出文件，会自动更换扩展名为.cs
dotnet run 测试文件/产品管理.My
```

## 编译流程

1. **词法分析**：将中文代码分解为词法单元（Token）
2. **语法分析**：将词法单元序列解析为抽象语法树（AST）
3. **代码生成**：将AST转换为C#代码

## 示例输出

### 输入（中文）
```中文
接口 I产品 {
    公开 产品ID: 整数;
    公开 产品名称: 字符串;
    公开 产品价格: 小数;
    
    抽象方法 获取详细信息: 字符串;
}

类 基础产品 继承 I产品 {
    公开 产品ID: 整数;
    公开 产品名称: 字符串;
    公开 产品价格: 小数;
    
    构造函数(id: 整数, 名称: 字符串, 价格: 小数) {
        产品ID = id;
        产品名称 = 名称;
        产品价格 = 价格;
    }
    
    方法 获取详细信息: 字符串 {
        返回 "产品ID: " + 产品ID + ", 名称: " + 产品名称;
    }
}
```

### 输出（C#）
```csharp
// 此文件由中文转C#编译器自动生成
// 请勿手动修改此文件

using System;
using System.Collections.Generic;

namespace Generated_产品管理
{
    public interface I产品
    {
        public int 产品ID { get; set; }
        public string 产品名称 { get; set; }
        public double 产品价格 { get; set; }
        public bool 是否可用 { get; set; }

        string 获取详细信息();
        double 计算折扣(double 折扣率);
        void 更新价格(double 新价格);
    }

    public class 基础产品 : I产品
    {
        public int 产品ID { get; set; }
        public string 产品名称 { get; set; }
        public double 产品价格 { get; set; }
        public bool 是否可用 { get; set; }
        public readonly string 创建时间 { get; set; }
        public static int 产品总数 { get; set; }

        public 基础产品(int id, string 名称, double 价格)
        {
            this.产品ID = id;
            this.产品名称 = 名称;
            this.产品价格 = 价格;
            this.是否可用 = true;
            this.创建时间 = "2023-01-01";
            this.产品总数++;
        }

        public string 获取详细信息()
        {
            return string.Empty;
        }

        public override double 计算折扣(double 折扣率)
        {
            return 0;
        }

        public void 更新价格(double 新价格)
        {
        }
    }
}
```

## 技术栈

- **.NET 8.0**：运行时框架
- **C#**：开发语言
- **经典编译器架构**：词法分析、语法分析、代码生成

## 开发说明

本项目采用经典的三阶段编译器架构：

1. **词法分析器**（词法分析器.cs）
   - 识别中文关键字和标识符
   - 生成词法单元流
   - 支持单行注释

2. **语法分析器**（语法分析器.cs）
   - 递归下降解析
   - 构建抽象语法树
   - 支持接口、类、方法、构造函数
   - 支持继承和多接口实现
   - 支持各种访问修饰符和方法类型

3. **代码生成器**（Cs代码生成器.cs）
   - 访问AST节点
   - 生成对应的C#代码
   - 自动添加必要的using语句
   - 基于文件名生成唯一命名空间

## 已支持的功能

✅ **完整的数据类型支持**：整数、小数、字符串、布尔值、对象、无返回值  
✅ **所有访问修饰符**：公开、私有、保护、只读、静态  
✅ **方法类型**：普通方法、虚方法、重写方法、抽象方法  
✅ **面向对象特性**：类、接口、继承、多接口实现  
✅ **构造函数**：有参和无参构造函数，构造函数链  
✅ **可为空类型**：支持所有类型的可空版本  
✅ **引用参数**：支持ref参数传递  
✅ **继承链**：支持多层继承关系  
✅ **复杂参数**：多参数方法，不同类型组合  

## 测试文件

简单测试与高级测试展现项目的成果

- 接口定义和实现
- 类继承和多接口实现
- 所有访问修饰符
- 所有数据类型
- 可为空类型
- 引用参数
- 各种方法类型
- 构造函数重载
- 静态成员
- 继承链

## 更新日志

### v1.0.1
- 修复了语法分析器中接口方法解析的问题
- 修复了基类构造函数参数传递的问题
- 修复了参数名中包含关键字的解析问题
- 优化了C#代码生成器的返回类型推断

### v1.0.0
- 初始版本发布
- 支持基本的中文编程语法
- 实现完整的编译器架构
- 提供一键编译脚本
- 包含完整的测试框架

## 已修复的问题

### 1. 接口方法解析问题
**问题描述**：
语法分析器在解析接口方法时，假设所有方法声明都是"方法名:返回类型"的格式，但接口中的方法声明是"方法名()"的格式，没有返回类型。

**解决方案**：
在语法分析器的解析方法函数中添加了检查，判断方法名后面是冒号还是左圆括号：
- 如果是左圆括号，则是接口方法声明，默认返回类型为string
- 如果是冒号，则是普通方法声明，继续解析返回类型

### 2. 基类构造函数参数传递问题
**问题描述**：
C#代码生成器在生成基类构造函数调用时，只传递了第一个参数给基类，但基类构造函数需要多个参数。

**解决方案**：
更新了C#代码生成器，根据基类名称决定传递哪些参数：
- 对于基础实现类，只传递名称参数
- 对于图形类，传递X、Y和颜色三个参数
- 默认情况下，传递第一个参数

### 3. 参数名关键字处理问题
**问题描述**：
参数名"新X"被错误处理为"new X"，导致生成的代码不正确。

**解决方案**：
在C#代码生成器的标识符表达式生成函数中添加了特殊处理：
- 检查是否是"new X"这样的参数引用，转换为"新X"
- 保持参数名的正确性

### 4. 方法返回类型推断问题
**问题描述**：
接口方法默认返回类型为void，但实现中有返回语句，导致编译错误。

**解决方案**：
修改了接口方法的默认返回类型为string，与实现中的返回语句匹配：
- 接口方法声明：`方法名()` → 返回类型为string
- 类方法实现：`返回 "字符串"` → 正确匹配
